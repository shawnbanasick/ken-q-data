!function(t){function e(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}({3:function(t,e){!function(t,e,n){"use strict";t.filePickedJSON=function(n){var r,a=n.target.files,o=a[0],s=new FileReader;s.onload=function(){return function(n){r=n.target.result;var a=JSON.parse(r);e.setState("JsonObj",a),t.setRespondentId(a)}}(),s.readAsText(o)},t.setRespondentId=function(t){$(".jsonSelect").show(),$(".downloadCsvDataDiv").show();var n=Object.keys(t),r=Object.keys(t[n[0]]),a=t[n[0]].name;e.setState("qavProjectName",a),$(".jsonFileName").html('"'+a+'" loaded'),$.each(r,function(t,e){$("#jsonIdSelect").append($("<option>",{value:t}).text(e))})},t.stageJsonData=function(){var n,r,a,o,s,i,l,u,p,c,f,d,v;if($("#existingDatabaseStatementList").empty(),$("#existingDatabaseRespondentList").empty(),u=document.getElementById("statementsInputBoxJson").value,"error"!==(n=t.processStatementInput(u))){for(e.setState("qavCurrentStatements",n),e.setState("qavOriginalSortSize",n.length),e.setState("originalSortSize",n.length),r=0,l=n.length;r<l;r++)$("#existingDatabaseStatementList").append("<li>"+n[r]+"</li>");a=$("#jsonIdSelect :selected").text(),o=e.getState("JsonObj");var h=t.pullRespondentNamesAndSortInformation(o,a);v=h[0],c=h[1],s=h[2],i=h[3],p=h[4];for(var S=0,g=v.length;S<g;S++)$("#existingDatabaseRespondentList").append("<li>"+v[S]+'<button class="deleteButtonSort vertical">delete sort</button></li>');f=t.calculateSortDesignPattern(o,s,i),d=t.calculateMultiplierArray(f),e.setState("multiplierArray",d),e.setState("qavSortTriangleShape",f),e.setState("qavRespondentNames",p),e.setState("qavRespondentSortsFromDbStored",c)}},t.calculateMultiplierArray=function(t){for(var e,n=[],r=0,a=t.length;r<a;r++)t[r]!==e?n.push(1):n[n.length-1]++,e=t[r];for(var o=t[0],s=-6,i=Math.abs(s-o),l=0;l<i;l++)n.unshift(0);for(var u=0;u<20;u++)n.length<20&&n.push(0);return n},t.calculateSortDesignPattern=function(t,e,n){var r,a,o=[];t[e[1]].sort,r=n.split("|");for(var s=0,i=r.length;s<i;s++)a=+r[s],o.push(a);return o.sort(function(t,e){return t-e}),o},t.pullRespondentNamesAndSortInformation=function(t,e){for(var n,r,a,o,s,i=[],l=[],u=[],p=Object.keys(t),c=0,f=p.length;c<f;c++){"ID"===e?(n=p[c].slice(-10),i.push(n)):(n=t[p[c]][e],i.push(n)),r=t[p[c]].sort,a=""+r.split("|");var d=a.split("+").join(""),v=a.split("+").join(" "),h=d.split(",").join(","),S=v.split(",").join("");l.push(S),o=h.split(" 0").join("0"),s=n+","+o,u.push(s)}return[u,l,p,r,i]},t.processStatementInput=function(t){var e=t.split(/\r\n|\r|\n/g);if(e.length<2){console.log("no statements uploaded for JSON");var n=$("#genericErrorModal .errorPanel");return n.empty(),n.append("<p>Please add Q-sort statements before staging JSON data</p><br>"),VIEW.showGenericErrorModal(),"error"}return e.filter(function(t){return t})},t.convertToData=function(t){for(var e=[],n=[],r=Object.keys(t),a=Object.keys(t[r[0]]),o=t[r[0]].sort,s=o.split("|"),i=0,l=s.length;i<l;i++){var u="S"+(i+1);n.push(u)}var p=a.concat(n);p.unshift("Id"),e.push(p);for(var c=0,f=r.length;c<f;c++){var d=[],v=r[c],h=t[v],S=Object.keys(h),g=v.slice(-10);d.push(g);for(var m=0,b=S.length;m<b;m++){var j=h[S[m]];d.push(j)}for(var I=h.sort,O=I.split("|"),y=0,x=O.length;y<x;y++){var D=+O[y];d.push(D)}e.push(d)}return e},t.downloadJsonData=function(){for(var n=e.getState("JsonObj"),r=e.getState("qavProjectName"),a=t.convertToData(n),o=[],s=0,i=a.length;s<i;++s){for(var l=0,u=a[s].length;l<u;l++)a[s][l]=UTIL.sanitizeUserInputText(a[s][l]);o.push(a[s].join(","))}UTIL.exportToCsv(r+".csv",a)}}(window.FIREBASE=window.FIREBASE||{},QAV)}});