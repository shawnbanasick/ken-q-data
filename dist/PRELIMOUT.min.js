!function(t){function e(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var a={};e.m=t,e.c=a,e.i=function(t){return t},e.d=function(t,a,r){e.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}({7:function(t,e){!function(t,e,a){"use strict";function r(t){function e(t){function e(t,e){return-1!==e.indexOf(t)}var a=[];a.push("#"+t.id);for(var r=0;r<t.classList.length;r++)e("."+t.classList[r],a)||a.push("."+t.classList[r]);for(var n=t.getElementsByTagName("*"),o=0;o<n.length;o++){var s=n[o].id;e("#"+s,a)||a.push("#"+s);for(var i=n[o].classList,r=0;r<i.length;r++)e("."+i[r],a)||a.push("."+i[r])}for(var l="",o=0;o<document.styleSheets.length;o++){var u=document.styleSheets[o];try{if(!u.cssRules)continue}catch(t){if("SecurityError"!==t.name)throw t;continue}for(var d=u.cssRules,c=0;c<d.length;c++)e(d[c].selectorText,a)&&(l+=d[c].cssText)}return l}function a(t,e){var a=document.createElement("style");a.setAttribute("type","text/css"),a.innerHTML=t;var r=e.hasChildNodes()?e.children[0]:null;e.insertBefore(a,r)}t.setAttribute("xlink","http://www.w3.org/1999/xlink"),a(e(t),t);var r=new XMLSerializer,n=r.serializeToString(t);return n=n.replace(/(\w+)?:?xlink=/g,"xmlns:xlink="),n=n.replace(/NS\d+:href/g,"xlink:href")}function n(t,e,a,r,n){var o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t))),s=document.createElement("canvas"),i=s.getContext("2d");s.width=e,s.height=a;var l=new Image;l.onload=function(){i.clearRect(0,0,e,a),i.drawImage(l,0,0,e,a),s.toBlob(function(t){var e=Math.round(t.length/1024)+" KB";n&&n(t,e)})},l.src=o}t.showPreliminaryOutput1=function(){for(var a=e.getState("distStatementDataVizArray"),r=e.getState("outputForDataViz"),n=e.getState("userSelectedFactors"),o=e.getState("vizConfig")||{},s=0;s<r.length;s++)for(var i=0;i<a[s].length;i++){var l,u=a[s][i]["No."],d=parseInt(u,10);if(!isNaN(d)){for(var c="Z-SCR-"+n[s],g=a[s][i][c],h=[],p=0;p<n.length;p++){var f="Z-SCR-"+n[p],m=a[s][i][f];h.push(m)}for(var v=_.pull(h,g),S=[],w=[],y=0;y<v.length;y++)g-v[y]>0?w.push("1"):S.push("1");var x;x=v.length===w.length&&n.length>1?!1!==o.shouldUseUnicode?"►":">>":v.length===S.length?!1!==o.shouldUseUnicode?"◄":"<<":"";var I="SIG"+n[s],b=a[s][i][I],N=u-1;"*"===b?l=!1!==o.shouldUseUnicode?"◉":"** ":""===b&&(l=!1!==o.shouldUseUnicode?"◎":"* "),!1!==o.shouldShowZscoreArrows?r[s][N].sigVisualization=l+x:!1===o.shouldShowZscoreArrows&&(r[s][N].sigVisualization=l)}}t.drawSynSortTrianglesForOutput(r,n)},t.drawSynSortTrianglesForOutput=function(){function o(t){for(var e=0;e<t.length;e++)for(var a=0;a<t[e].length;a++)!1===w.shouldPrependStateNo?t[e][a].displayStatements=t[e][a].sortStatement:t[e][a].displayStatements=t[e][a].statement+". "+t[e][a].sortStatement;return t}function s(t){for(var e=0;e<t.length;e++)for(var a=0;a<t[e].length;a++)if(!0===w.shouldTrimStatements){var r=t[e][a].displayStatements;t[e][a].displayStatements=r.substring(0,w.trimStatementSize)}return t}function i(t,e){for(var a,r=[],n=0;n<e.length;n++){a=0;for(var o=0;o<t.length;o++)t[o]===e[n]&&a++;r.push(a)}return r}function l(t){w.heightAdjustment=0;var e,a=[],r=_.cloneDeep(t);r.sort();for(var n=0;n<r.length;n++)r[n]!==e?a.push(1):a[a.length-1]++,e=r[n];return h=(parseInt(c,10)+10)*d3.max(a)+75}function u(t,a){var r,n=(e.getState("language"),[]);if(!0===w.shouldSetWidthForAsian)a=w.asianStatmentLength||12,n=t.match(new RegExp(".{1,"+a+"}","g"));else for(var o=new RegExp(".{0,"+a+"}(?:\\s|$)","g");""!=(r=o.exec(t));)n.push(r);return n}try{var d,c,g,h,p,f,m=e.getState("qavSortTriangleShape"),v=(e.getState("qavCurrentStatements"),e.getState("language")),S=(resources[v].translation["Synthetic Sort for"],resources[v].translation.Legend,_.uniq(m)),w=e.getState("vizConfig")||{},y="12px",x=$(".container").width()-40,I=(w.consensusCustomColor,w.matchCountCustomColor,w.overlapCustomColor,w.shouldUseToIndicateConsensus,w.shouldUseToIndicateMatchCaution,w.shouldUseToIndicateOverlap,w.shouldAddEmptySort);if(!0===w.shouldSetCardWidth?(p=w.cardWidth,x=p*S.length+10):p=x/S.length,!0===w.shouldSetFontSize&&(y=w.fontSize+"px"),!0===w.shouldSetCardHeight){var b=w.cardHeight;b===a&&(b=110),c=parseInt(b,10)}else c=110;!0===w.shouldSetSymbolFontSize?w.sigSymbolFontSize+"px":"12px",g=!0===w.shouldSetLineSpacing?w.lineSpacing:15;for(var N=e.getState("qavRespondentSortsFromDbStored"),T=e.getState("qavRespondentNames"),V=UTIL.checkUniqueName(T),z=e.getState("qavCurrentStatements"),C=e.getState("qavOriginalSortSize"),E=t.convertSortsTextToNumbers(N,C),L=[],A=0,P=E.length;A<P;A++){for(var U=[],D=0,M=E[A].length;D<M;D++){var R={};V[A]=V[A].trim(),V[A]=V[A].replace(/ /g,"_"),R.factor=V[A],R.sigVisualization="",R.sortStatement=z[D],R.sortValue=E[A][D],R.statement=D+1,U.push(R)}L.push(U)}if(e.setState("qavRespondentNames",V),e.setState("respondentNames",V),!0===I){for(var k=[],q=0;q<E[0].length;q++){var O={};O.factor="",O.sigVisualization="",O.sortStatement="",O.statement=q+1,O.sortValue=E[0][q],k.push(O)}E.unshift(m),L.unshift(k),V.unshift("Q-sort Pattern")}o(L);var B;B=!0===w.shouldShowMatchCounts||w.shouldIndicateDistinguishing?40:w.shouldIndicateDistinguishing===a?40:20,!0===w.shouldTrimStatements&&s(L);var F,W=w.statementWidth||6.75;F=!0===w.shouldSetStatementWidth?parseInt((p-W)/6.75,10):parseInt(p/6.75,10);for(var G,Q=0;Q<L.length;Q++){for(var j=i(E[Q],S),H=[],Z=0,K=0;K<j.length;K++){for(var X=0;X<j[K];X++)H.push(Z);Z+=1}for(var J,Y=[],tt=0;tt<j.length;tt++){J=0;for(var et=0;et<j[tt];et++)Y.push(J),J+=1}d=l(E[Q]);var at=Q+1,rt="factorVizDiv"+at;$("#synFactorVizDiv").append("<div id="+rt+"></div>"),G=at<10?"00":at<100?"0":"";var nt="synSortSvgNo"+G+at,ot=d3.select("#"+rt).append("svg").attr("width",x+10).attr("height",d).attr("id",nt).attr("class","factorViz"),st=L[Q],it=st.slice(0);it.sort(function(t,e){return t.zScore===e.zScore?t.sortValue-e.sortValue:e.sortValue-t.sortValue});for(var lt=0;lt<it.length;lt++)it[lt].xVal=H[lt],it[lt].yVal=Y[lt];var ut=ot.selectAll("g.node").data(S,function(t){return t}),dt=ut.enter().append("g").attr("class","node");dt.append("rect").attr("width",p).attr("height","20").attr("x",function(t){return S.indexOf(t)*p+5}).attr("y","45").attr("fill","white").attr("stroke","black"),dt.append("text").attr("x",function(t){return S.indexOf(t)*p+p/2+5}).attr("y","57").style("text-anchor","middle").attr("class","headerText").attr("font-family","Arial").attr("font-size","14px").attr("font-weight","bold").attr("fill","black").text(function(t){return t});var ct=ot.selectAll("g.node2").data(it,function(t){return t.statement}),gt=ct.enter().append("g").attr("class","node2");gt.append("rect").attr("width",p).attr("height",c).attr("x",function(t){return t.xVal*p+5}).attr("y",function(t){return t.yVal*c+60}).attr("fill",function(t){return"#ffffff"}).style("background-color","#ffffff").attr("stroke","black"),gt.append("text").attr("class","wrap").attr("font-family","Arial").attr("font-size",y).attr("x",function(t){return t.xVal*p+8}).attr("y",function(t){return t.yVal*c+B+25}).attr("dy",0).each(function(t){for(var e=u(t.displayStatements,F),a=0;a<e.length;a++)d3.select(this).append("tspan").attr("dy",g).attr("text-anchor","middle").attr("x",t.xVal*p+p/2).text(e[a])});var ht=V[Q];ot.append("text").attr("x",5).attr("y",28).attr("font-family","Arial").attr("font-size","30px").attr("fill","black").text(ht);var pt=resources[v].translation.downloadImage,ft=$("#"+rt);ft.append('<input class="svgDownloadButton blackHover" name="downloadButton" id="'+V[Q]+'Image"   type="button" value="'+V[Q]+pt+'" />'),ft.append('<input class="pngDownloadButton blackHover" name="downloadPngButton" id="'+V[Q]+'PngImage"   type="button" value="'+V[Q]+' - Download image as PNG" />')}$(".svgDownloadButton").on("mousedown",function(t){var a=e.getState("vizConfig")||{},r=a.shouldAddCustomName,n=$(this).parent().find("svg").attr("id"),o=n.slice(-3)-1,s=V[o],i=s.replace(/\s+/g,""),l=(UTIL.currentDate1(),UTIL.currentTime1(),e.getState("qavProjectName")),u=a.customName;f=!0===r?"prepend"===a.customNameLocation?{filename:u+"_"+l+"_"+i}:"append"===a.customNameLocation?{filename:l+"_"+i+"_"+u}:"replace"===a.customNameLocation?{filename:u}:{filename:l+"_"+i}:{filename:l+"_"+i},d3_save_svg.save(d3.select("#"+n).node(),f)}),$(".pngDownloadButton").on("mousedown",function(t){function a(t,e){saveAs(t,m)}var o,s=e.getState("vizConfig")||{},i=s.shouldAddCustomName,l=$(this).parent().find("svg").attr("id"),u=l.slice(-3)-1,d=V[u],c=d.replace(/\s+/g,""),g=(UTIL.currentDate1(),UTIL.currentTime1(),e.getState("qavProjectName")),h=s.customName;o=!0===i?"prepend"===s.customNameLocation?h+"_"+g+"_"+c:"append"===s.customNameLocation?g+"_"+c+"_"+h:"replace"===s.customNameLocation?h:g+"_"+c:g+"_"+c;var p=r(d3.select("#"+l).node()),f=d3.select("#"+l);n(p,2*(parseInt(f.style("width"),10)+2),2*parseInt(f.style("height"),10),"png",a);var m=o+".png"})}catch(t){console.log(t);var mt=$("#genericErrorModal .errorPanel");mt.empty(),mt.append("<p>Q-sorts must be loaded before display</p><br>"),VIEW.showGenericErrorModal()}},t.downloadAllImages=function(){try{for(var t=e.getState("qavRespondentNames"),a=0;a<t.length;a++){var r="#"+t[a]+"Image";$(r).trigger("mousedown")}}catch(t){var n=$("#genericErrorModal .errorPanel");n.empty(),n.append("<p>Q-sorts must be displayed before download</p><br>"),VIEW.showGenericErrorModal()}},t.downloadAllPngImages=function(){try{var a=e.getState("qavRespondentNames"),r=0;setInterval(function(){if(r<a.length){var e="#"+a[r]+"PngImage";t.downloadPngImage(e),r++}},2e3)}catch(t){var n=$("#genericErrorModal .errorPanel");n.empty(),n.append("<p>Q-sorts must be displayed before download</p><br>"),VIEW.showGenericErrorModal()}},t.downloadPngImage=function(t){console.log("triggered"),$(t).trigger("mousedown")},t.convertSortsTextToNumbers=function(t,a){var r=e.getState("qavRespondentNames"),n=[];return!1===_.isArray(t[0])?_(t).forEach(function(t,e){var o,s,i,l=0,u=2,d=[],c=a;for(o=0;o<c;o++){if(s=t.slice(l,u),i=+s,isNaN(i)){console.log("non-numeric data value");var g=$("#genericErrorModal .errorPanel");g.empty(),g.append("<p>The Q-sort for respondent "+r[e]+" contains a non-numeric data value</p>"),VIEW.showGenericErrorModal()}d.push(i),l+=2,u+=2}n.push(d)}).value():n=_.cloneDeep(t),e.setState("sortsAsNumbers",n),n}}(window.PRELIMOUT=window.PRELIMOUT||{},QAV)}});