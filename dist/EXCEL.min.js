!function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}({2:function(e,t){!function(e,t,r){"use strict";function a(r){var a,n,s=t.getState("language"),o=(resources[s].translation["has missing statement numbers"],resources[s].translation["has an incorrect statement number"],resources[s].translation["The number of statements in the statments sheet of the Excel file does not match the number of statements in the sorts sheet"]),i=r[0][0][1];t.setState("qavProjectName",i);var l=r[0],p=e.createMultiplierArrayAndTriangleShape(l),u=p[0],c=p[1];t.setState("qavSortTriangleShape",c),t.setState("multiplierArray",u);var g=c.length;t.setState("qavOriginalSortSize",g),t.setState("qavTotalStatements",g),t.setState("originalSortSize",g);var h=e.prepInputData(l,g),S=h.shift(),v=e.getRespondentNames(S);t.setState("qavRespondentNames",v),t.setState("respondentNames",v);var f=v.length;t.setState("qavTotalNumberSorts",f),t.setState("totalNumberSorts",f);var m=e.getRespondentSorts(h),d=m[0],x=m[1];t.setState("qavRespondentSortsFromDbStored",d);var b=_.cloneDeep(d),T=_.cloneDeep(d),y=r[1],E=e.getStatements(y);t.setState("qavCurrentStatements",E);var P=E.length,D=e.testSymmetryOfSorts(c,T,x,P);n=D[0],a=D[1];var N=[];if(0===n.length&&"true"===a){for(var q=0;q<E.length;q++){var L=E[q];$("#existingDatabaseStatementList").append("<li>"+L+"</li>")}for(var M=0;M<b.length;M++){var A=b[M],R=A.join(),w=R.replace(/,/g," ").replace(/ -/g,"-");"-"!==w.charAt(0)&&(w=" "+w),N.push(w);var I=v[M];$("#existingDatabaseRespondentList").append("<li>"+I+","+A+"</li>")}$(".jsonDownloadPQ").show()}else{$("#genericErrorModal .errorPanel").empty();for(var j=0;j<n.length;j++)$("#genericErrorModal .errorPanel").append("<p>"+v[n[j][0]]+" "+n[j][1]+"</p><br>");"false"===a&&$("#genericErrorModal .errorPanel").append("<h6>"+o+"</h6>"),VIEW.showGenericErrorModal()}t.setState("qavRespondentSortsFromDbStored",N)}function n(r){var a=t.getState("language"),n=(resources[a].translation["has missing Q-sort values"],resources[a].translation["has an incorrect Q-sort value"],resources[a].translation["Non-Symmetric Q-sorts"]),s=[],o=r[0][0][1],i=o.toString().replace(/,/g,"");t.setState("qavProjectName",i);var l=e.calcSortTriangleShapeT2(r[0][0][3]),p=l[0],u=l[1],c=l[2];t.setState("qavSortTriangleShape",c),s=e.calcMultiplierArrayT2(p),t.setState("multiplierArray",s);var g=c.length;t.setState("qavOriginalSortSize",g),t.setState("qavTotalStatements",g),t.setState("originalSortSize",g);var h=r[0][0],S=e.grabRespondentNamesAndSorts(h),v=S[0],f=S[1],m=S[2];t.setState("qavRespondentNames",v),t.setState("respondentNames",v);var d=v.length;t.setState("qavTotalNumberSorts",d),t.setState("totalNumberSorts",d);var x=f;t.setState("qavRespondentSortsFromDbStored",x);var b=r[1][0],T=e.grabProjectStatements(b);t.setState("qavCurrentStatements",T);var y=e.checkForErrors(u,m),E=y[0],_=y[1],P=[];if(0===E.length){for(var D=0;D<T.length;D++){var N=T[D];$("#existingDatabaseStatementList").append("<li>"+N+"</li>")}for(var q=0;q<x.length;q++){var L=x[q],M=L.replace(/,/g," ").replace(/ -/g,"-");"-"!==M.charAt(0)&&(M=" "+M),P.push(M);var A=v[q];$("#existingDatabaseRespondentList").append("<li>"+A+","+L+"</li>")}if(_.length>0){$("#nonSymmetricSortsDiv").append("<h4>"+n+"</h4>");for(var R=0;R<_.length;R++)$("#nonSymmetricSortsDiv").append("<p>"+v[_[R]]+", </p>")}$(".jsonDownloadPQ").show()}else{$("#genericErrorModal .errorPanel").empty();for(var w=0;w<E.length;w++)$("#genericErrorModal .errorPanel").append("<p>"+v[E[w][0]]+" "+E[w][1]+"</p><br>");VIEW.showGenericErrorModal()}t.setState("qavRespondentSortsFromDbStored",P)}function s(e){return","==e.slice(-1)&&(e=e.slice(0,-1)),e}function o(e){return e.replace(/[^a-zA-Z0-9.-]/g,function(){return""})}function i(e,t){var r=_.cloneDeep(t);return e.sort().join(",")!==r.sort().join(",")?1:0}function l(r){var a=r[0][0][0][""];t.setState("qavProjectName",a);var n=e.grabSortTriangleShapeT3(r[0][0][4][""]),s=n[0],o=n[1];t.setState("qavSortTriangleShape",s);var i=e.calcMultiplierArrayT2(o);t.setState("multiplierArray",i);var l=s.length;t.setState("qavOriginalSortSize",l),t.setState("qavTotalStatements",l),t.originalSortSize=l;var p=e.grabRespondentNamesT3(r[2]);t.setState("qavRespondentNames",p),t.setState("respondentNames",p);var u=p.length;t.setState("qavTotalNumberSorts",u),t.setState("totalNumberSorts",u);var c=e.grabSortsT3(r[2],l),g=e.grabStatementsT3(r[1][0]);t.setState("qavCurrentStatements",g);var h=(_.cloneDeep(c),[]),S=[];if(0===h.length){for(var v=0;v<g.length;v++){var f=g[v];$("#existingDatabaseStatementList").append("<li>"+f+"</li>")}for(var m=0;m<c.length;m++){var d=c[m],x=d.join(),b=x.replace(/,/g," ").replace(/ -/g,"-");"-"!==b.charAt(0)&&(b=" "+b),S.push(b);var T=p[m];$("#existingDatabaseRespondentList").append("<li>"+T+","+d+"</li>")}$(".jsonDownloadPQ").show()}t.setState("qavRespondentSortsFromDbStored",S)}e.exportExcelSortsPQM=function(){var e=[];$("#existingDatabaseRespondentList li").each(function(){var t=$(this).text();e.push(t)});var r,a,n,s,o,i;r=e.length,a=String(UTIL.threeDigitPadding(r)),n=t.getState("qavProjectName");for(var l=t.getState("qavSortTriangleShape"),p=_.min(l),u=_.max(l),c=String(UTIL.threeDigitPadding(+p)),g=String(UTIL.threeDigitPadding(+u)),h=t.getState("multiplierArray"),S="",v="",f=0;f<20;f++)S=String(UTIL.threeDigitPadding(h[f])),v+=S;s=t.getState("qavCurrentStatements"),o=0===s.length?l.length:s.length,i=String(UTIL.threeDigitPadding(o));var m=c+g+v;$("#excelSortExportBox").append("  0"+a+i+" "+n),$("#excelSortExportBox").append("\n"),$("#excelSortExportBox").append(m),$("#excelSortExportBox").append("\n");for(var d=0;d<e.length;d++){var x=e[d].split(","),b=x[0],T=INPUT.sanitizeRespondentName(b),y=x.slice(1,x.length),E=y.toString();"sort"===E.slice(-4)&&(E=E.replace(/delete sort/g,""));var P=E.replace(/,/g," "),D=P.replace(/ -/g,"-"),N=D.replace(/[\[\]']+/g,"");N=+x[1]<0?"  "+N:"   "+N;var q=T+N;$("#excelSortExportBox").append(q),$("#excelSortExportBox").append("\n")}var L=$("#excelSortExportBox").val(),M=UTIL.currentDate1()+"-"+UTIL.currentTime1(),A=new Blob([L],{type:"text/plain;charset=us-ascii"});saveAs(A,"Ken-Q_PQMethod_Export_"+M+".DAT"),$("#excelSortExportBox").html("")},e.exportStatementsToPqmethod=function(){for(var e=t.getState("qavCurrentStatements"),r=$("#excelSortExportBox"),a=0;a<e.length;a++)r.append(e[a],"\n");var n=r.val(),s=UTIL.currentDate1()+"-"+UTIL.currentTime1(),o=new Blob([n],{type:"text/plain;charset=us-ascii"});saveAs(o,"Ken-Q_PQMethod_Statements_"+s+".STA"),$("#excelSortExportBox").html("")},e.filePicked=function(e){var r,s,o,i,l,p,u,c,g=t.getState("typeOfExcelFile"),h=e.target.files[0],S=new FileReader,v=[],f=[],m=!1,d=!1;S.onload=function(e){if(l=e.target.result,p=XLSX.read(l,{type:"binary"}),c=p.SheetNames,c.forEach(function(e){if(u=p.Sheets[e],"sorts"===e)if(m=!0,r=XLSX.utils.sheet_to_csv(u),s=r.split(/\n/),"user-input"===g)for(var t=1;t<100;t++)o=s[t].split(","),v.push(o);else"unforced"===g&&(o=s.filter(Boolean),v.push(o));else"statements"===e&&(d=!0,v=[],i=XLSX.utils.sheet_to_json(u),v.push(i));f.push(v)}),!1===m){var t=$("#genericErrorModal .errorPanel");t.empty(),t.append("<p>Can't find Q-sorts. Please check your file's formatting and try again.</p><br>"),VIEW.showGenericErrorModal()}if(!1===d){var t=$("#genericErrorModal .errorPanel");t.empty(),t.append("<p>Can't find sort statements. Please check your file's formatting and try again.</p><br>"),VIEW.showGenericErrorModal()}"user-input"===g?a(f):"unforced"===g&&n(f)},S.readAsBinaryString(h)},e.filePickedKenq=function(e){var r=t.getState("language"),a=resources[r].translation["Project Overview"],n=resources[r].translation.Statements;console.log("branch 1");var s=e.target.files[0],o=new FileReader;o.onload=function(e){var t=e.target.result,r=XLSX.read(t,{type:"binary"}),s=!1,o=!1,i=!1,p=[];if(r.SheetNames.forEach(function(e){var t,s=r.Sheets[e];if(e===a){t=[];var l=XLSX.utils.sheet_to_json(s);t.push(l)}else if("Q-sorts"===e){i=!0;var u=XLSX.utils.sheet_to_csv(s),c=u.split(/\n/);t=[],c.forEach(function(e){var r=e.split(",");t.push(r)})}else if(e===n){o=!0,t=[];var g=XLSX.utils.sheet_to_json(s);t.push(g)}p.push(t)}),!1===i){var u=$("#genericErrorModal .errorPanel");u.empty(),u.append("<p>Can't find Q-sorts. Please check your file's formatting and try again.</p><br>"),VIEW.showGenericErrorModal()}if(!1===o){var u=$("#genericErrorModal .errorPanel");u.empty(),u.append("<p>Can't find sort statements. Please check your file's formatting and try again.</p><br>"),VIEW.showGenericErrorModal()}console.log(s,o),l(p)},o.readAsBinaryString(s)},e.testSymmetryOfSorts=function(e,r,a,n){for(var s,o,l,p=t.getState("language"),u=resources[p].translation["has missing statement numbers"],c=resources[p].translation["has an incorrect Q-sort value"],g=_.cloneDeep(e),h=[],S=d3.range(1,g.length+1),v=_.max(S),f=_.min(S),m=0;m<r.length;m++)l=_.max(a[m]),o=_.min(a[m]),l>v||o<f?h.push([m,c]):i(a[m],S)>0&&h.push([m,u]);s=n!==g.length?"false":"true";return[h,s]},e.getStatements=function(e){for(var t=[],a=0,n=e[0].length;a<n;a++){var s=e[0][a].Statements;""===s||s===r||null===s||t.push(s)}return t},e.getRespondentSorts=function(e){for(var t=_.zip.apply(_,e),r=[],a=0;a<t.length;a++){var n=_.sortBy(t[a],function(e){return e.statementNum});r.push(n)}for(var s,o,i=[],l=[],p=0;p<r.length;p++){for(var u=r[p],c=[],g=[],h=0;h<u.length;h++)s=u[h].sortValue,o=u[h].statementNum,c.push(s),g.push(o);l.push(c),i.push(g)}return[l,i]},e.getRespondentNames=function(e){for(var t=[],r=0,a=e.length;r<a;r++){var n=e[r].statementNum;""!==n&&t.push(n)}return t=UTIL.checkUniqueName(t)},e.prepInputData=function(e,t){for(var r=[],a=29+t,n=e[28].length-1,s=28;s<a;s++){for(var o,i,l=e[s][0],p=[],u=1,c=0;c<n;c++)o=e[s][u],28===s&&""!==o?(i={},i.sortValue=l,i.statementNum=o,p.push(i)):""!==o&&(i={},i.sortValue=+l,i.statementNum=+o,p.push(i)),u+=1;r.push(p)}return r},e.createMultiplierArrayAndTriangleShape=function(e){for(var t=[],r=[],a=4;a<24;a++){var n=+e[a][1];if(n<1||isNaN(n))r.push(0);else{var s=+e[a][1];r.push(s);for(var o=+e[a][0],i=0,l=s;i<l;i++)t.push(o)}}return[r,t]},e.checkForErrors=function(e,r){for(var a,n,s=t.getState("language"),o=resources[s].translation["has missing statement numbers"],l=resources[s].translation["has an incorrect statement number"],p=[],u=[],c=_.max(e),g=_.min(e),h=e.length,S=0,v=r.length;S<v;S++)r[S].length!==h&&p.push([S,o]),n=_.max(r[S]),a=_.min(r[S]),(n>c||a<g)&&p.push([S,l]),i(r[S],e)>0&&u.push(S);return[p,u]},e.grabProjectStatements=function(e){for(var t=[],a=0,n=e.length;a<n;a++){var s=e[a].Statements;""===s||s===r||null===s||t.push(s)}return t},e.grabRespondentNamesAndSorts=function(e){for(var t=[],r=[],a=[],n=[],o=6;o<e.length;o++){var i=e[o].toString().replace(/,,/g,"");if(i.length<5)break;a.push(i),i=s(i);var l=i.split(","),p=l.shift(),u=l.toString();r.push(p),n.push(u),t.push(l)}return[r,n,t]},e.calcMultiplierArrayT2=function(e){for(var t,r=[],a=0,n=e.length;a<n;a++)e[a]!==t?r.push(1):r[r.length-1]++,t=e[a];for(var s=e[0],o=-6,i=Math.abs(o-s),l=0;l<i;l++)r.unshift(0);for(var p=0;p<20;p++)r.length<20&&r.push(0);return r},e.calcSortTriangleShapeT2=function(e){var t=e.replace(/,,/g,"");t=s(t);var r=t.replace(/Sort Pattern,/,""),a=r.split(",");for(var n in a)a[n]=parseInt(a[n],10);return[_.cloneDeep(a),_.cloneDeep(a),_.cloneDeep(a)]},e.grabStatementsT3=function(e){for(var t=[],a=1;a<e.length;a++){var n=e[a][""];""===n||n===r||null===n||t.push(n)}return t},e.grabSortsT3=function(e,t){for(var a=[],n=4;n<e.length;n++){var s=[],i=e[n][1];if(""===i||null===i||i===r);else{var l=e[n][1],p=o(l);s.push(+p);for(var u=t,c=2;c<u;c++){var g=e[n][c];s.push(+g)}var h=e[n][u],S=o(h);s.push(+S),a.push(s)}}return a},e.grabRespondentNamesT3=function(e){for(var t=[],r=1,a=e.length;r<a;r++){var n=e[r][0];""===n||t.push(n)}return t.slice(2)},e.grabSortTriangleShapeT3=function(e){var t=JSON.parse("["+e+"]"),r=_.cloneDeep(t);return[t,r]}}(window.EXCEL=window.EXCEL||{},QAV)}});